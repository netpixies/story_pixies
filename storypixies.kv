#:kivy 1.10.1
#: import FadeTransition kivy.uix.screenmanager.FadeTransition
#: import win kivy.core.window
#: import SimpleTableLayout kivy.garden.SimpleTableLayout
<StoryBase>:
    BoxLayout:
        orientation: "vertical"

        BoxLayout:
            size_hint: 1, None
            height: '48dp'
            Button:
                text: 'Choose Library'
                background_normal: 'images/backgrounds/button.png'
                on_release: sm.current = 'story_home'
                bold: True
            Button:
                text: 'My Library'
                background_normal: 'images/backgrounds/button.png'
                on_release: sm.current = 'story_library'
                bold: True
            Button:
                text: 'Creator'
                background_normal: 'images/backgrounds/button.png'
                on_release: sm.current = 'story_creator'
                bold: True
            Button:
                text: 'Settings'
                background_normal: 'images/backgrounds/button.png'
                on_release: sm.current = 'story_settings'
                bold: True
            Button:
                text: 'Book'
                background_normal: 'images/backgrounds/button.png'
                on_release: sm.current = 'story_book'
                bold: True

        ScreenManager:
            id: sm
            transition: FadeTransition()
            StoryFront:
            StoryHome:
            StoryLibrary:
            StoryCreator:
            StorySettings:
            StoryBook:

<StoryFront>:
    title: "Welcome to Story Pixies!"
    Button:
        on_release: root.manager.current = 'story_home'
        background_normal: 'images/background.png'
        allow_stretch: True
        bold: True
        outline_width: 10
        italic: True
        outline_color: [0, 0, 0]
        size: self.parent.size
        pos: self.parent.pos
    Label:
        text: "Welcome to Story Pixies!"
        size: self.parent.size
        pos: self.parent.pos
        font_size: 60
        bold: True


<LibraryButton@Button>:
    libraries: app.libraries
    selected_library: app.selected_library
    background_normal: 'images/backgrounds/button.png'
    font_size: 60
    bold: True
    outline_width: 10
    italic: True
    height: 200
    size_hint_y: None
    outline_color: (0,0,0,0)
    on_press: app.set_selected_library(self.text)
    on_release:
        if app.selected_library == self.text: \
        self.parent.manager.current = 'story_library'


<StoryHome>:
    name: 'story_home'
    libraries: app.libraries
    selected_library: app.selected_library

    BoxLayout:
        id: story_home_id
        ScrollView:
            bar_width: 0
            id: library_scroll_view
            size_hint_x: 1
            size_hint_y: None
            size: (win.Window.width,win.Window.height)
            GridLayout:
                id: library_grid
                manager: root.manager
                cols: 1
                size_hint_y: None
                size_hint_x: 1
                spacing: 10
                padding: 10
                scroll_y: slider.value
                on_touch_move: slider.value = self.scroll_y

        Slider:
            size_hint_x: None
            width: root.width*0.2
            id: slider
            min: 0
            max: 1
            orientation: 'vertical'
            value: library_scroll_view.scroll_y
            on_value: library_scroll_view.scroll_y = self.value


<StoryCreator>:
    name: 'story_creator'
    BoxLayout:
        Button:
            text: 'Story Creator'







<StoryLibrary>:
    name: 'story_library'
    selected_story: app.selected_story
    stories: app.stories
    BoxLayout:
        size_hint_y: None

    SimpleTableLayout:
        manager: root.manager
        id: story_layout
        cols: 4
        rows: 8

        Button:
            text: 'Back'
            bold: True
            on_press: story_button.text = app.prev_story()
            on_release: story_button_image.source = app.get_story_media()
            background_normal: 'images/backgrounds/button.png'

        Label:
            colspan: 2
            text: story_button.text
            font_size: 30
            bold: True
            outline_width: 10
            italic: True
            outline_color: (0,0,0,0)

        Button:
            text: 'Next'
            on_press: story_button.text = app.next_story()
            on_release: story_button_image.source = app.get_story_media()
            bold: True
            background_normal: 'images/backgrounds/button.png'

        Button:
            id: story_button
            text: 'Taking a Trip'
            colspan: 4
            rowspan: 7
            selected_story: app.selected_story
            size_hint_y: None
            size_hint_x: 1
            font_size: 0
            on_release:
                if app.selected_story == self.text: \
                self.parent.manager.current = 'story_book'
            background_normal: 'images/backgrounds/button.png'

            Image:
                id: story_button_image
                source: 'images/mushroom-table.jpg'
                pos: story_button.pos
                size: story_button.size
                allow_stretch: True
                keep_ratio: True



<StoryTemplate>:
    name: 'story_template'
    BoxLayout:
        id: story_template

<StoryBook>:
    name: 'story_book'
    id: story_book
    selected_library: app.selected_library
    selected_story: app.selected_story
    template_config: app.template_config
    story_config: app.story_config
    current_page: app.current_page
    current_page_no: app.current_page_no

    GridLayout:
        id: story_book_grid
        cols: 2
        spacing: '8dp'



<CustomData>:
    name: 'custom_data'
    BoxLayout:
        id: custom_data_box

<StorySettings>:
    name: 'story_settings'

    BoxLayout:
        id: settings
        canvas:
            Color:
                rgba: 1.0, 0.5, 0.0, 0.0
            Rectangle:
                size: self.size
                pos: self.pos
        Button:
            text: 'Settings'
            on_release: app.open_settings()

