#:kivy 1.10.1
#: import SimpleTableLayout kivy.garden.simpletablelayout
#: import win kivy.core.window
#: import partial functools.partial


<StoryPixiesApp>:
    canvas.before:
        Color:
            rgba: (0.99, 0.98, 0.86, 1)
        Rectangle:
            pos: self.pos
            size: self.size

<MainMenu>:
    canvas.before:
        Color:
            rgba: (0.99, 0.98, 0.86, 1)
        Rectangle:
            pos: self.pos
            size: self.size
    rows: 1
    size_hint: (1, None)
    height: 50

    homebutton: homebutton
    librarybutton: librarybutton
    storybutton: storybutton
    creatorbutton: creatorbutton
    ToggleButton:
        id: homebutton
        group: 'mainmenu'
        state: 'down'
        text: 'Home'
        bold: True
        on_press: app.home_screen(self)
        background_normal: 'images/backgrounds/button-blue-normal.png'
        background_down: 'images/backgrounds/button-blue-down.png'
    ToggleButton:
        id: librarybutton
        group: 'mainmenu'
        text: 'Library'
        bold: True
        on_press: app.library_screen(self)
        background_normal: 'images/backgrounds/button-blue-normal.png'
        background_down: 'images/backgrounds/button-blue-down.png'
    ToggleButton:
        id: storybutton
        group: 'mainmenu'
        text: 'Story'
        bold: True
        on_press: app.story_screen(self)
        background_normal: 'images/backgrounds/button-blue-normal.png'
        background_down: 'images/backgrounds/button-blue-down.png'
    ToggleButton:
        id: creatorbutton
        group: 'mainmenu'
        text: 'Creator'
        bold: True
        disabled: app.creator_disabled
        on_press: app.creator_screen(self)
        background_normal: 'images/backgrounds/button-blue-normal.png'
        background_down: 'images/backgrounds/button-blue-down.png'


<LibraryButton>:
    libraries: app.libraries
    background_normal: 'images/backgrounds/button-blue-normal.png'
    font_size: 60
    bold: True
    italic: True
    size_hint_y: None
    color: (1,1,1,1)
    on_press: app.set_selected_library(self.text)
    on_release: app.library_screen(self)

<Home>:
    canvas.before:
        Color:
            rgba: (0.99, 0.98, 0.86, 1)
        Rectangle:
            pos: self.pos
            size: self.size
    libraries: app.libraries
    app: app

    GridLayout:
        id: home_grid

        cols: 3
        spacing: 10
        padding: 10

        RstDocument:
            background_color: (0.99, 0.98, 0.86, 1)
            text: app.intro_text()
            size_hint_x: 1
        ScrollView:
            bar_width: 0
            id: library_scroll_view
            size_hint_x: 0.4
            size_hint_y: None
            size: (win.Window.width,win.Window.height)
            GridLayout:
                id: library_grid
                cols: 1
                size_hint_x: 1
                spacing: 10
                padding: 10
                scroll_y: slider.value
                on_touch_move: slider.value = self.scroll_y

        Slider:
            size_hint_x: 0.05
            width: root.width*0.05
            id: slider
            min: 0
            max: 1
            orientation: 'vertical'
            value: library_scroll_view.scroll_y
            on_value: library_scroll_view.scroll_y = self.value


<Library>:
    app: app
    canvas.before:
        Color:
            rgba: (0.99, 0.98, 0.86, 1)
        Rectangle:
            pos: self.pos
            size: self.size
    BoxLayout:
        size_hint_y: None

    SimpleTableLayout:
        id: story_layout
        cols: 4
        rows: 22

        Button:
            text: 'Back'
            bold: True
            on_press: story_button.text = app.get_library_object().prev_story()
            on_release: story_button_image.source = app.get_library_object().get_story().get_story_media()
            background_normal: 'images/backgrounds/button-blue-normal.png'

        Button:
            text: story_button.text + ": Click to Read Now!"
            colspan: 2
            bold: True
            on_release: app.story_screen(self)
            background_normal: 'images/backgrounds/button-blue-normal.png'

        Button:
            text: 'Next'
            bold: True
            on_press: story_button.text = app.get_library_object().next_story()
            on_release: story_button_image.source = app.get_library_object().get_story().get_story_media()
            background_normal: 'images/backgrounds/button-blue-normal.png'

        Button:
            id: story_button
            colspan: 4
            rowspan: 21
            current_story: app.get_library_object().current_story
            size_hint_y: None
            size_hint_x: 1
            font_size: 0
            bold: True
            on_release: app.story_screen(self)
            background_normal: 'images/backgrounds/button-yellow-normal.png'

            Image:
                id: story_button_image
                pos: story_button.pos
                size: story_button.size
                allow_stretch: True
                keep_ratio: True

<SingleLibrary>:
    app: app

<Story>:
    app: app
    canvas.before:
        Color:
            rgba: (0.99, 0.98, 0.86, 1)
        Rectangle:
            pos: self.pos
            size: self.size
    GridLayout:
        id: story_book_grid
        cols: 2
        spacing: 30

<StoryBook>:
    app: app


<Creator>:
    app: app
    creator_grid: creator_grid

    canvas.before:
        Color:
            rgba: (0.99, 0.98, 0.86, 1)
        Rectangle:
            pos: self.pos
            size: self.size
    BoxLayout:
        orientation: 'vertical'
        padding: 10
        spacing: 10
        id: creator_grid


<StoryTitle>:
    app: app
    story_title_grid: story_title_grid
    GridLayout:
        cols: 1
        rows: 4
        id: story_title_grid

<StoryPages>:
    app: app
    story_pages_grid: story_pages_grid
    GridLayout:
        cols: 1
        rows: 4
        id: story_pages_grid

<SettingButtons>:
    app: app
